# Local Testing with Act

This file contains examples of using [act](https://github.com/nektos/act) for local testing of GitHub Actions workflows.

## Installing act

```bash
# macOS
brew install act

# Linux
curl https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash

# Windows (via Chocolatey)
choco install act-cli
```

## Usage Examples

### 1. Testing all features (default)

```bash
# Run all tests
act workflow_dispatch

# Run only autogenerated tests
act workflow_dispatch -j test-autogenerated

# Run only scenario tests
act workflow_dispatch -j test-scenarios
```

### 2. Testing specific feature

```bash
# Test only yay feature
act workflow_dispatch --input features=yay

# Test only clone-repo feature
act workflow_dispatch --input features=clone-repo
```

### 3. Testing multiple features

```bash
# Test yay and clone-repo
act workflow_dispatch --input features=yay,clone-repo
```

### 4. Testing with specific base images

```bash
# Test only on archlinux:latest
act workflow_dispatch --input base_images=archlinux:latest

# Test on multiple images
act workflow_dispatch --input base_images=archlinux:latest,archlinux:base
```

### 5. Combined testing

```bash
# Test only yay on archlinux:latest
act workflow_dispatch --input features=yay --input base_images=archlinux:latest

# Test clone-repo on archlinux:base
act workflow_dispatch --input features=clone-repo --input base_images=archlinux:base
```

### 6. Testing pull request events

```bash
# Simulate PR (will test all features)
act pull_request
```

### 7. Testing push events

```bash
# Simulate push to main branch
act push
```

## Useful act flags

```bash
# Show only list of jobs without execution
act workflow_dispatch --list

# Run with verbose logging
act workflow_dispatch --verbose

# Use specific Docker image for runner
act workflow_dispatch --platform ubuntu-latest=catthehacker/ubuntu:act-latest

# Run in dry-run mode
act workflow_dispatch --dry-run

# Reuse containers (faster for repeated runs)
act workflow_dispatch --reuse
```

## Development Examples

### Quick testing of yay feature changes

```bash
# Test only yay on single image
act workflow_dispatch \
  --input features=yay \
  --input base_images=archlinux:latest \
  --reuse
```

### Testing new changes in clone-repo

```bash
# Test clone-repo scenarios
act workflow_dispatch \
  --input features=clone-repo \
  -j test-scenarios \
  --reuse
```

### Full testing before commit

```bash
# Run all tests like in CI
act workflow_dispatch --reuse
```

## act Configuration

Create `.actrc` file in project root for default settings:

```bash
# .actrc
--platform ubuntu-latest=catthehacker/ubuntu:act-latest
--reuse
--verbose
```

## Troubleshooting

### Docker Issues

```bash
# If act cannot find Docker
export DOCKER_HOST=unix:///var/run/docker.sock

# Clear act cache
act --rm
```

### Permission Issues

```bash
# Run with sudo if needed
sudo act workflow_dispatch --input features=yay
```

### Network Issues in Containers

```bash
# Use host network
act workflow_dispatch --network host
```

## Execution Monitoring

```bash
# Follow logs in real time
act workflow_dispatch --verbose | tee act-run.log

# Analyze only errors
act workflow_dispatch 2>&1 | grep -i error
