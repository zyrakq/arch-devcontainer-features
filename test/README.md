# DevContainer Features Testing

This directory contains tests for the devcontainer features in this repository.

## Test Structure

```sh
test/
├── yay/                    # Tests for yay AUR helper feature
│   ├── test.sh            # Basic yay installation test
│   ├── test_with_packages.sh  # Test with package installation
│   └── scenarios.json     # Test scenarios configuration
├── clone-repo/            # Tests for clone-repo feature
│   ├── test.sh            # Basic clone script installation test
│   ├── test_https_clone.sh    # Test HTTPS repository cloning
│   ├── test_branch_clone.sh   # Test branch-specific cloning
│   ├── test_default_target.sh # Test default target directory
│   ├── test_existing_repo.sh  # Test existing repository handling
│   └── scenarios.json     # Test scenarios configuration
├── node/                  # Tests for Node.js and npm feature
│   ├── test.sh            # Basic Node.js installation test
│   ├── test_latest_version.sh # Test latest version installation
│   ├── test_nvm_install.sh    # Test nvm installation method
│   ├── test_with_packages.sh  # Test with global packages
│   ├── test_yarn_pnpm.sh      # Test Yarn and pnpm installation
│   └── scenarios.json     # Test scenarios configuration
├── rust/                  # Tests for Rust and Cargo feature
│   ├── test.sh            # Basic Rust installation test
│   ├── test_nightly.sh    # Test nightly toolchain
│   ├── test_additional_targets.sh # Test additional compilation targets
│   ├── test_cargo_tools.sh    # Test cargo tools installation
│   ├── test_global_crates.sh  # Test global crates installation
│   ├── test_minimal.sh    # Test minimal installation
│   ├── test_full_setup.sh # Test full setup with all options
│   └── scenarios.json     # Test scenarios configuration
├── dotnet/                # Tests for .NET SDK and Runtime feature
│   ├── test.sh            # Basic .NET installation test
│   ├── pacman_basic.sh    # Test basic pacman installation
│   ├── pacman_custom_tools.sh # Test custom tools installation
│   ├── pacman_minimal.sh  # Test minimal installation
│   ├── pacman_specific_version.sh # Test specific version
│   ├── pacman_with_aspnet.sh  # Test with ASP.NET Core
│   ├── pacman_with_tools.sh   # Test with development tools
│   └── scenarios.json     # Test scenarios configuration
└── dotnet-bin/            # Tests for .NET SDK and Runtime (AUR) feature
    ├── test.sh            # Basic .NET AUR installation test
    ├── aur_basic.sh       # Test basic AUR installation
    ├── aur_custom_tools.sh    # Test custom tools installation
    ├── aur_specific_version.sh # Test specific version
    ├── aur_with_tools.sh  # Test with development tools
    ├── basic.sh           # Test basic functionality
    └── scenarios.json     # Test scenarios configuration
```

## Running Tests

### Local Testing

To run tests locally, you need the devcontainer CLI:

```bash
# Install devcontainer CLI
npm install -g @devcontainers/cli

# Run all tests
devcontainer features test .

# Run tests for specific feature
devcontainer features test -f yay .
devcontainer features test -f clone-repo .
devcontainer features test -f node .
devcontainer features test -f rust .
devcontainer features test -f dotnet .
devcontainer features test -f dotnet-bin .

# Run only autogenerated tests (skip scenarios)
devcontainer features test --skip-scenarios .

# Run only scenario tests
devcontainer features test --skip-autogenerated .
```

### CI/CD Testing

Tests are automatically run via GitHub Actions:

- **On push to main branch**
- **On pull requests**
- **Manual workflow dispatch**

## Test Coverage

### Yay Feature Tests

- **Basic installation**: Verifies yay is installed and functional
- **Package installation**: Tests installing AUR packages
- **Compatibility**: Tests on Arch Linux base images
- **Permissions**: Verifies user permissions for package operations

### Clone-repo Feature Tests

- **Basic functionality**: Verifies git and clone script installation
- **HTTPS cloning**: Tests cloning public repositories via HTTPS
- **Branch cloning**: Tests cloning specific branches
- **Default target**: Tests default workspace directory behavior
- **Existing repository**: Tests handling of existing repositories
- **Arch Linux compatibility**: Tests on Arch Linux base images

### Node.js Feature Tests

- **Basic installation**: Verifies Node.js and npm installation
- **Version management**: Tests different Node.js versions (LTS, latest)
- **Installation methods**: Tests pacman and nvm installation methods
- **Global packages**: Tests npm global package installation
- **Package managers**: Tests Yarn and pnpm installation
- **Sudo-free configuration**: Verifies npm prefix configuration

### Rust Feature Tests

- **Basic installation**: Verifies Rust, Cargo, and rustup installation
- **Toolchain versions**: Tests stable, beta, and nightly toolchains
- **Components**: Tests clippy and rustfmt installation
- **Additional targets**: Tests cross-compilation targets (WebAssembly, Windows, etc.)
- **Global crates**: Tests cargo global crate installation
- **Development tools**: Tests cargo development utilities
- **Minimal setup**: Tests minimal installation without optional components
- **Full setup**: Tests complete development environment

### .NET Feature Tests

- **Basic installation**: Verifies .NET SDK and runtime installation
- **Version management**: Tests specific .NET versions
- **ASP.NET Core**: Tests ASP.NET Core runtime installation
- **Development tools**: Tests Entity Framework and global tools
- **Pacman integration**: Tests installation via official Arch packages
- **Minimal setup**: Tests minimal installation options

### .NET (AUR) Feature Tests

- **AUR installation**: Verifies .NET installation from AUR packages
- **Version management**: Tests specific .NET versions from AUR
- **Development tools**: Tests global tools installation
- **Compatibility**: Tests with yay AUR helper dependency

## Test Images

### All Features

- `archlinux:latest` - Primary test image for all features
- `archlinux:base` - Minimal Arch Linux image (where applicable)

### Feature-Specific Images

- **Yay**: Arch Linux images only
- **Clone-repo**: Any Linux distribution (cross-platform)
- **Node.js**: Arch Linux images with pacman support
- **Rust**: Arch Linux images with rustup support
- **Dotnet**: Arch Linux images with official .NET packages
- **Dotnet-bin**: Arch Linux images with AUR support (requires yay)

## Test Scenarios

Test scenarios are defined in `scenarios.json` files and include:

- Different feature option combinations
- Various base images
- Specific use cases and edge cases

## Troubleshooting

If tests fail:

1. **Check base image compatibility**: Ensure the feature supports the test image
2. **Verify network access**: Some tests require internet connectivity
3. **Check permissions**: Ensure proper user permissions in test containers
4. **Review logs**: Check GitHub Actions logs for detailed error information

## Adding New Tests

To add tests for a new feature:

1. Create `test/<feature-name>/` directory
2. Add `test.sh` for basic functionality tests
3. Add additional test files for specific scenarios
4. Create `scenarios.json` for complex test configurations
5. Update `.github/workflows/test.yaml` to include the new feature
6. Make test scripts executable: `chmod +x test/<feature-name>/*.sh`
